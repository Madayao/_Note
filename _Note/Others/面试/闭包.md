@(前端.面试)[JS,闭包,面试]

# 闭包
----

## 目录

[TOC]

# 个人看法

闭包的关键在于函数内的变量在函数内的函数里变动, 即关注于同时出现在内部函数内外的变量, 这个变量会积累变化

# 作用域

## 作用域链
创建函数 f1, 内部再嵌套一个函数 f2, 此时有三个作用域

在 f2 中调用变量会先在 f2 的作用域中寻找, 再向 f1 作用域寻找, 最后是全局作用域, 就形成了作用域链

#　闭包的特点
## 闭包的劣势

1. 闭包携带包含它的函数的作用域, 占用更多内存. 过度使用闭包可能导致内存占用过多, 导致内存泄漏

## 闭包的优势

1. 保存自己私有的变量，通过提供的接口（方法）给外部使用，但外部不能直接访问该变量。


# 题目

详见测试中的闭包

### 1

使用闭包实现如下程序
函数每调用一次，该函数的返回值加 1

```js
var f = (function () {
    var a = 0
    return function () {
        console.log('a', ++a)
    }
})()

f()
f()
```
### 2

输出是什么?
```
function foo(x) {
    var tmp = 3
    return function (y) {
        console.log(x + y + (++tmp))
    }
}
foo(2)
var bar = foo(2)
bar(10)
bar(10)
```
```
16
17
```

### 3

输出多少, 如何改变?
```
for (var i = 1; i <= 5; i++) {
    setTimeout( function timer() {
        console.log(i);
    }, 1000);
}
```

```
6
6
6
6
6
```
```
for (var i = 1; i <= 5; i++) {
    (function(i){setTimeout( function timer() {
        console.log(i);
    }, 1000)})(i);
}
```
